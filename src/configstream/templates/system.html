{% extends "base.html" %}
{% block title %}System - ConfigStream{% endblock %}
{% block content %}
<div class="card">
    <h2>System Monitoring</h2>
    <p class="text-muted" style="margin-bottom: 2rem;">
        Live status of the ConfigStream application and host system.
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="card">
            <h3>System Status</h3>
            <div id="system-status">
                <p>Loading...</p>
            </div>
        </div>
        <div class="card">
            <h3>Logs</h3>
            <pre id="logs" style="max-height: 400px; overflow-y: auto; background: #f0f0f0; padding: 1rem; border-radius: 8px;"></pre>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function fetchSystemStatus() {
    const statusDiv = document.getElementById('system-status');
    try {
        const response = await fetch('/api/status');
        const data = await response.json();
        statusDiv.innerHTML = `
            <p><strong>Uptime:</strong> ${data.uptime}</p>
            <p><strong>CPU Usage:</strong> ${data.cpu.percent}%</p>
            <p><strong>Memory Usage:</strong> ${data.memory.used_mb}MB / ${data.memory.total_mb}MB (${data.memory.percent}%)</p>
        `;
    } catch (error) {
        statusDiv.innerHTML = '<p style="color: red;">Error loading system status.</p>';
    }
}

async function fetchLogs() {
    const logsPre = document.getElementById('logs');
    try {
        const response = await fetch('/api/logs');
        const data = await response.json();
        logsPre.textContent = data.logs.join('\\n');
    } catch (error) {
        logsPre.textContent = 'Error loading logs.';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    fetchSystemStatus();
    fetchLogs();
    setInterval(fetchSystemStatus, 5000);
    setInterval(fetchLogs, 5000);
});
</script>
{% endblock %}