{% extends "base.html" %}

{% block title %}Report - ConfigStream{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <header class="bg-header-bg shadow-lg rounded-lg p-6 mb-8">
        <h1 class="text-3xl font-bold text-white">Latest Report</h1>
        <p class="text-text-secondary">View the latest report.</p>
    </header>

    <main>
        <div class="bg-card-bg p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-4">Report Details</h2>
            <div class="bg-header-bg p-4 rounded-md">
                <pre class="text-sm text-text-secondary whitespace-pre-wrap" id="report-content">Loading report...</pre>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block head_extra %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/report')
            .then(async (response) => {
                if (!response.ok) {
                    const text = await response.text().catch(() => '');
                    throw new Error(text || `Failed to load report (${response.status})`);
                }
                // Try JSON first; fall back to text
                try {
                    return await response.json();
                } catch {
                    const t = await response.text().catch(() => '');
                    return t ? { raw: t } : { message: 'No content' };
                }
            })
            .then((data) => {
                const reportContent = document.getElementById('report-content');
                reportContent.textContent = typeof data === 'string'
                  ? data
                  : JSON.stringify(data, null, 2);
            })
            .catch((err) => {
                const reportContent = document.getElementById('report-content');
                reportContent.textContent = `Error loading report: ${err.message}`;
            });
    });
</script>
{% endblock %}