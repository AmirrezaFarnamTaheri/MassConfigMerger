<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - ConfigStream</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/docs.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <img src="img/logo.svg" alt="ConfigStream Logo" class="nav-logo">
                <span>ConfigStream</span>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="docs.html">Documentation</a></li>
                <li><a href="quickstart.html">Quick Start</a></li>
                <li><a href="roadmap.html">Roadmap</a></li>
                <li><a href="api.html" class="active">API</a></li>
                <li><a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream" class="github-btn">
                    <i class="fab fa-github"></i> GitHub
                </a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <div class="docs-container">
        <aside class="docs-sidebar">
            <div class="sidebar-section">
                <h3>Core Classes</h3>
                <ul>
                    <li><a href="#ConfigProcessor">ConfigProcessor</a></li>
                    <li><a href="#SourceManager">SourceManager</a></li>
                    <li><a href="#NodeTester">NodeTester</a></li>
                    <li><a href="#Database">Database</a></li>
                </ul>
            </div>
        </aside>

        <main class="docs-content">
            <div class="docs-header">
                <h1>API Reference</h1>
                <p class="lead">This is a basic reference for the core classes in ConfigStream. More detailed documentation will be generated automatically in the future.</p>
            </div>

            <section id="ConfigProcessor" class="docs-section">
                <h2><i class="fas fa-cogs"></i> ConfigProcessor</h2>
                <p>The main class for processing configurations. It handles filtering, testing, and normalization.</p>
                <div class="code-block"><pre><code>from configstream.core.config_processor import ConfigProcessor
from configstream.config import Settings

processor = ConfigProcessor(Settings())</code></pre></div>
                <h3>Methods</h3>
                <ul>
                    <li><code>filter_configs(configs: set[str], use_fetch_rules: bool = False) -> set[str]</code>: Filters a set of configurations based on the current settings.</li>
                    <li><code>test_configs(configs: set[str]) -> list[dict]</code>: Tests a set of configurations for connectivity and latency.</li>
                    <li><code>create_semantic_hash(config: str) -> str</code>: Creates a hash of a configuration for deduplication.</li>
                </ul>
            </section>

            <section id="SourceManager" class="docs-section">
                <h2><i class="fas fa-cloud-download-alt"></i> SourceManager</h2>
                <p>Manages fetching configurations from various sources.</p>
                <div class="code-block"><pre><code>from configstream.core.source_manager import SourceManager

manager = SourceManager(settings)
configs = await manager.fetch_sources(source_urls)
await manager.close_session()</code></pre></div>
                <h3>Methods</h3>
                <ul>
                    <li><code>fetch_sources(sources: list[str]) -> set[str]</code>: Fetches configurations from a list of source URLs.</li>
                    <li><code>check_and_update_sources(sources_file: Path) -> list[str]</code>: Checks the validity of sources and updates the source file.</li>
                </ul>
            </section>

            <section id="NodeTester" class="docs-section">
                <h2><i class="fas fa-network-wired"></i> NodeTester</h2>
                <p>Handles testing of individual nodes for connectivity, latency, and country of origin.</p>
                <div class="code-block"><pre><code>from configstream.tester import NodeTester

tester = NodeTester(settings)
latency = await tester.test_connection("example.com", 443)
country = await tester.lookup_country("example.com")
await tester.close()</code></pre></div>
                 <h3>Methods</h3>
                <ul>
                    <li><code>test_connection(host: str, port: int) -> float | None</code>: Tests the TCP connection to a host and port, returning the latency in seconds.</li>
                    <li><code>lookup_country(host: str) -> str | None</code>: Looks up the country of a host using a GeoIP database.</li>
                </ul>
            </section>

            <section id="Database" class="docs-section">
                <h2><i class="fas fa-database"></i> Database</h2>
                <p>Manages the SQLite database for storing proxy history and other data.</p>
                <div class="code-block"><pre><code>from configstream.db import Database

db = Database(Path("proxy_history.db"))
await db.connect()
await db.record_proxy("vmess://...", success=True, ping=0.123)
history = await db.get_proxy_history()
await db.close()</code></pre></div>
                <h3>Methods</h3>
                <ul>
                    <li><code>record_proxy(config: str, success: bool, ping: float)</code>: Records the result of a proxy test.</li>
                    <li><code>get_proxy_history() -> list[dict]</code>: Retrieves the entire proxy history.</li>
                    <li><code>prune_old_records(days: int)</code>: Removes records older than a specified number of days.</li>
                </ul>
            </section>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>ConfigStream</h4>
                    <p>High-performance VPN configuration aggregator and merger.</p>
                    <div class="social-links">
                        <a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Documentation</h4>
                    <ul>
                        <li><a href="quickstart.html">Quick Start</a></li>
                        <li><a href="docs.html">Full Documentation</a></li>
                        <li><a href="api.html">API Reference</a></li>
                        <li><a href="roadmap.html">Roadmap</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream/issues">Report Issues</a></li>
                        <li><a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream/discussions">Discussions</a></li>
                        <li><a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream/blob/main/CONTRIBUTING.md">Contributing</a></li>
                        <li><a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream/blob/main/CHANGELOG.md">Changelog</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="docs.html#faq">Troubleshooting</a></li>
                        <li><a href="#">Community</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 ConfigStream. Released under GNU GPL v3.0.</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script src="js/docs.js"></script>
</body>
</html>