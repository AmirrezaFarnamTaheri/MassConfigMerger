<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConfigStream - Proxy Configuration Manager</title>

    <!-- Your CSS files here -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- CRITICAL: CSS for logo animation - comes BEFORE any scripts -->
    <style>
        /* Logo animation - spins on load */
        @keyframes spin-rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Apply animation to logo element during page load */
        .logo-animated {
            animation: spin-rotate 1s linear 1 forwards;
        }

        /* After animation completes, logo should be solid black */
        .logo-animated.animation-complete {
            filter: brightness(0);
            color: #000000;
        }

        /* For inline SVG logos */
        .logo-animated.animation-complete svg {
            filter: brightness(0);
        }

        /* For image logos */
        .logo-animated.animation-complete img {
            filter: brightness(0);
        }
    </style>
</head>
<body>
    <div id="preloader">
        <svg class="logo-animated" width="80" height="80" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="var(--brand-primary)"/>
                    <stop offset="100%" stop-color="var(--brand-secondary)"/>
                </linearGradient>
            </defs>
            <g>
                <path d="M29.5 6C36.4036 6 42 11.5964 42 18.5C42 25.4036 36.4036 31 29.5 31H14.5" stroke="url(#logo-gradient)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14.5 38C7.59644 38 2 32.4036 2 25.5C2 18.5964 7.59644 13 14.5 13H29.5" stroke="url(#logo-gradient)" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
            </g>
        </svg>
    </div>
    <!-- Your HTML content here -->

    <!--
    ========================================================================
    SCRIPT LOADING ORDER - THIS IS CRITICAL FOR CACHE FUNCTIONALITY
    ========================================================================

    The order below must be respected:
    1. Cache configuration (loaded FIRST)
    2. Cache manager (depends on cache configuration)
    3. Any other scripts that use cache features
    4. Service worker registration (happens last)

    If you change this order, you will get undefined reference errors.
    -->

    <!-- STEP 1: Load shared cache configuration FIRST -->
    <!-- This file creates globalThis.ConfigStreamCache -->
    <script src="/assets/js/cache-config.js"></script>

    <!-- STEP 2: Load cache manager SECOND -->
    <!-- This file needs globalThis.ConfigStreamCache to exist -->
    <script src="/assets/js/cache-manager.js"></script>

    <!-- STEP 3: Load your main application scripts -->
    <!-- These can now safely use either cacheManager or globalThis.ConfigStreamCache -->
    <script src="/assets/js/main.js"></script>

    <!-- STEP 4: Register the service worker and handle updates -->
    <!-- This inline script comes LAST, after everything else is loaded -->
    <script>
        // Verify that cache manager is available
        if (typeof cacheManager === 'undefined') {
            console.error('FATAL: cacheManager is not available! cache-manager.js failed to load.');
        }

        // Verify that cache configuration is available
        if (!globalThis.ConfigStreamCache) {
            console.error('FATAL: Cache configuration not available! cache-config.js failed to load.');
        }

        // Listen for service worker updates
        window.addEventListener('sw-update-ready', () => {
            console.log('A new version of the app is available. Reload to update.');
            // You can show a notification here
        });

        // Optional: Add a debug command to the console
        window.cacheDebug = async function() {
            const stats = await cacheManager.getCacheStats();
            console.log('Cache Statistics:', stats);
            console.log('Cache Configuration:', globalThis.ConfigStreamCache);
        };

        console.log('Application initialized. Type cacheDebug() in console for cache info.');
    </script>
</body>
</html>