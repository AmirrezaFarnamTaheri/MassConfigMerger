<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free, auto-updated, and tested VPN configurations.">
    <title>ConfigStream - Modern VPN Configuration Aggregator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        :root {
            --background: #f0f2f5;
            --surface: #ffffff;
            --primary: #5a67d8;
            --primary-light: #7f8de4;
            --text-main: #2d3748;
            --text-secondary: #718096;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.05);
        }

        body.dark {
            --background: #1a202c;
            --surface: #2d3748;
            --primary: #805ad5;
            --primary-light: #9f7aea;
            --text-main: #e2e8f0;
            --text-secondary: #a0aec0;
            --border-color: #4a5568;
            --shadow-color: rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            padding: 2rem;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s, border-bottom 0.2s;
            border-bottom: 2px solid transparent;
        }

        .tab-button.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background-color: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .card h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .action-button {
            background-color: var(--primary);
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-button:hover {
            background-color: var(--primary-light);
        }

        .copy-button.copied {
            background-color: #28a745;
        }

        #proxies-table {
            width: 100%;
        }

        footer {
            text-align: center;
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="src/configstream/logo.svg" alt="ConfigStream Logo" class="logo"/>
                <h1>ConfigStream</h1>
            </div>
            <div class="theme-switcher">
                <button id="theme-toggle">
                    <i data-feather="sun"></i>
                    <i data-feather="moon" style="display:none;"></i>
                </button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="subscriptions">Subscriptions</button>
            <button class="tab-button" data-tab="proxies">Proxies</button>
            <button class="tab-button" data-tab="about">About</button>
        </div>

        <main>
            <div id="subscriptions" class="tab-content active">
                <div class="grid">
                    <div class="card">
                        <h3>Base64 Subscription</h3>
                        <p>The universal format for most modern VPN clients (V2Ray, etc.).</p>
                        <div class="card-actions">
                             <a href="output/vpn_subscription_base64.txt" class="action-button download-button" download><i data-feather="download"></i>Download</a>
                            <button class="action-button copy-button" data-link="output/vpn_subscription_base64.txt"><i data-feather="copy"></i>Copy Link</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Clash Config</h3>
                        <p>A complete configuration file for Clash, Clash Meta, and derivatives.</p>
                        <div class="card-actions">
                            <a href="output/clash.yaml" class="action-button download-button" download><i data-feather="download"></i>Download</a>
                            <button class="action-button copy-button" data-link="output/clash.yaml"><i data-feather="copy"></i>Copy Link</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Raw Configs</h3>
                        <p>A simple text file with all unencoded configuration links.</p>
                        <div class="card-actions">
                            <a href="output/configs_raw.txt" class="action-button download-button" download><i data-feather="download"></i>Download</a>
                            <button class="action-button copy-button" data-link="output/configs_raw.txt"><i data-feather="copy"></i>Copy Link</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="proxies" class="tab-content">
                <table id="proxies-table" class="display">
                    <thead>
                        <tr>
                            <th>Protocol</th>
                            <th>Country</th>
                            <th>ASN</th>
                            <th>Remarks</th>
                            <th>Latency</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <div id="about" class="tab-content">
                <div class="card">
                    <h2>How to Use</h2>
                    <ul>
                        <li>Click a card above to download your preferred format.</li>
                        <li>Import the file or link directly into your VPN client.</li>
                        <li>Your client will automatically fetch updates if you use the subscription link.</li>
                        <li>Bookmark this page for easy access to fresh configs.</li>
                    </ul>
                </div>
                <div class="card">
                    <h2>Security Notice</h2>
                    <ul>
                        <li>These are public VPN nodes from unknown operators.</li>
                        <li>Traffic may be monitored. Do not use for sensitive data.</li>
                        <li>Ideal for casual browsing and bypassing geo-restrictions.</li>
                        <li>Always use at your own risk. No warranty is provided.</li>
                    </ul>
                </div>
            </div>
        </main>

        <footer>
            <p>
                Open Source & Community-Driven.
                <a href="https://github.com/AmirrezaFarnamTaheri/ConfigStream" target="_blank">View on GitHub</a>
            </p>
        </footer>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script>
        feather.replace();

        document.addEventListener('DOMContentLoaded', () => {
            // Theme switcher
            const themeToggle = document.getElementById('theme-toggle');
            const body = document.body;
            const sunIcon = themeToggle.querySelector('[data-feather="sun"]');
            const moonIcon = themeToggle.querySelector('[data-feather="moon"]');

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                body.classList.add(savedTheme);
                if (savedTheme === 'dark') {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                }
            }

            themeToggle.addEventListener('click', () => {
                body.classList.toggle('dark');
                const isDark = body.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                sunIcon.style.display = isDark ? 'none' : 'block';
                moonIcon.style.display = isDark ? 'block' : 'none';
            });

            // Tabs
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(button.dataset.tab).classList.add('active');
                });
            });

            // Fetch and populate proxies table
            async function fetchProxies() {
                try {
                    const response = await fetch('output/configs_raw.txt');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const text = await response.text();
                    const lines = text.trim().split('\n').filter(line => line.trim());

                    const table = $('#proxies-table').DataTable({
                        data: lines.map(line => {
                            const url = new URL(line);
                            return {
                                protocol: url.protocol.replace(':', ''),
                                country: 'N/A', // This will be updated later
                                asn: 'N/A', // This will be updated later
                                remarks: decodeURIComponent(url.hash.substring(1)),
                                latency: 'N/A', // This will be updated later
                                config: line,
                            }
                        }),
                        columns: [
                            { data: 'protocol' },
                            { data: 'country' },
                            { data: 'asn' },
                            { data: 'remarks' },
                            { data: 'latency' },
                            {
                                data: 'config',
                                render: function(data, type, row) {
                                    return `<button class="action-button copy-button" data-link="${data}"><i data-feather="copy"></i>Copy</button>`;
                                }
                            }
                        ]
                    });

                    feather.replace();
                } catch (error) {
                    console.error('Error fetching proxies:', error);
                }
            }

            fetchProxies();
        });
    </script>
</body>
</html>